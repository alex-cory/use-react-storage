"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _lodash = _interopRequireDefault(require("lodash.isempty"));

var _logger = require("../logger");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _nonIterableRest(); }

function _nonIterableRest() { throw new TypeError("Invalid attempt to destructure non-iterable instance"); }

function _iterableToArrayLimit(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i["return"] != null) _i["return"](); } finally { if (_d) throw _e; } } return _arr; }

function _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }

const logger = (0, _logger.createLogger)('eslint-help');
logger.debug('Loaded');
const namedOption = /^--/;
const header = /^(\w+(\s+)?)+\:$/i;

function parseNo(option, str) {
  if (!str) return;
  let cmd = str.replace('--', '');

  if (/no-/.test(cmd)) {
    logger.debug('Parsing no option', str);
    cmd = cmd.replace('no-', '');
    option.default = 'true';
  }

  option.option = cmd;
  return option;
}

function parseDouble(arr) {
  const description = arr.slice(2).filter(Boolean).join(' ');

  const _arr2 = _slicedToArray(arr, 2),
        option = _arr2[0],
        alias = _arr2[1];

  return {
    option: option.replace('--', ''),
    type: 'Boolean',
    alias: alias.replace('--', ''),
    description: description
  };
}

function parseRegular(arr) {
  const _arr3 = _slicedToArray(arr, 1),
        item = _arr3[0];

  logger.debug('Parsing %s', item);

  if (!item) {
    return;
  }

  const _arr4 = _slicedToArray(arr, 1),
        optionText = _arr4[0];

  const type = arr[1] || 'Boolean';
  const option = parseNo({}, optionText);
  const helpText = arr.filter(a => a !== optionText && a !== type && a !== '');
  const description = helpText.join(' ');
  option.type = type;

  if (description) {
    option.description = description;
  }

  return option;
}

function parseAlias(arr = []) {
  const _arr5 = _slicedToArray(arr, 1),
        alias = _arr5[0];

  logger.debug('Alias found: %s', alias);
  const option = parseRegular(arr.filter(a => a !== alias));

  if (alias) {
    option.alias = alias.replace('-', '');
  }

  return option;
}

function createOption(arr) {
  let option;

  if (namedOption.test(arr[0]) && namedOption.test(arr[1])) {
    // negated boolean
    option = parseDouble(arr);
  } else if (namedOption.test(arr[0]) && !namedOption.test(arr[1])) {
    // no alias
    option = parseRegular(arr);
  } else {
    // aliased or other
    option = parseAlias(arr);
  }

  return (0, _lodash.default)(option) ? undefined : option;
}

function parseHelp(helpText) {
  return helpText.split('\n').reduce((acc, line, index) => {
    if (!line || index === 0) {
      return acc;
    }

    if (index === 0) {
      return acc;
    }

    if (header.test(line)) {
      acc.push({
        heading: line.replace(':', '')
      });
      return acc;
    }

    const lineArr = line.replace(',', '').trim().split(' ');
    const option = createOption(lineArr);

    if (option.option === 'help') {
      return acc;
    }

    acc.push(option);
    return acc;
  }, []);
}

var _default = {
  parseHelp: parseHelp
};
exports.default = _default;
module.exports = exports.default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9lc2xpbnQvcGFyc2VyLmpzIl0sIm5hbWVzIjpbImxvZ2dlciIsImRlYnVnIiwibmFtZWRPcHRpb24iLCJoZWFkZXIiLCJwYXJzZU5vIiwib3B0aW9uIiwic3RyIiwiY21kIiwicmVwbGFjZSIsInRlc3QiLCJkZWZhdWx0IiwicGFyc2VEb3VibGUiLCJhcnIiLCJkZXNjcmlwdGlvbiIsInNsaWNlIiwiZmlsdGVyIiwiQm9vbGVhbiIsImpvaW4iLCJhbGlhcyIsInR5cGUiLCJwYXJzZVJlZ3VsYXIiLCJpdGVtIiwib3B0aW9uVGV4dCIsImhlbHBUZXh0IiwiYSIsInBhcnNlQWxpYXMiLCJjcmVhdGVPcHRpb24iLCJ1bmRlZmluZWQiLCJwYXJzZUhlbHAiLCJzcGxpdCIsInJlZHVjZSIsImFjYyIsImxpbmUiLCJpbmRleCIsInB1c2giLCJoZWFkaW5nIiwibGluZUFyciIsInRyaW0iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBQTs7QUFFQTs7Ozs7Ozs7Ozs7O0FBRUEsTUFBTUEsTUFBTSxHQUFHLDBCQUFhLGFBQWIsQ0FBZjtBQUNBQSxNQUFNLENBQUNDLEtBQVAsQ0FBYSxRQUFiO0FBRUEsTUFBTUMsV0FBVyxHQUFHLEtBQXBCO0FBQ0EsTUFBTUMsTUFBTSxHQUFHLG1CQUFmOztBQUVBLFNBQVNDLE9BQVQsQ0FBaUJDLE1BQWpCLEVBQXlCQyxHQUF6QixFQUE4QjtBQUM1QixNQUFJLENBQUNBLEdBQUwsRUFBVTtBQUVWLE1BQUlDLEdBQUcsR0FBR0QsR0FBRyxDQUFDRSxPQUFKLENBQVksSUFBWixFQUFrQixFQUFsQixDQUFWOztBQUVBLE1BQUksTUFBTUMsSUFBTixDQUFXRixHQUFYLENBQUosRUFBcUI7QUFDbkJQLElBQUFBLE1BQU0sQ0FBQ0MsS0FBUCxDQUFhLG1CQUFiLEVBQWtDSyxHQUFsQztBQUNBQyxJQUFBQSxHQUFHLEdBQUdBLEdBQUcsQ0FBQ0MsT0FBSixDQUFZLEtBQVosRUFBbUIsRUFBbkIsQ0FBTjtBQUNBSCxJQUFBQSxN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QUFUO0FBRUEsV0FBTzBCLEdBQVA7QUFDRCxHQTVCTSxFQTRCSixFQTVCSSxDQUFQO0FBNkJEOztlQUVjO0FBQ2JILEVBQUFBLFNBQVMsRUFBRUE7QUFERSxDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGlzRW1wdHkgZnJvbSAnbG9kYXNoLmlzZW1wdHknO1xuXG5pbXBvcnQgeyBjcmVhdGVMb2dnZXIgfSBmcm9tICcuLi9sb2dnZXInO1xuXG5jb25zdCBsb2dnZXIgPSBjcmVhdGVMb2dnZXIoJ2VzbGludC1oZWxwJyk7XG5sb2dnZXIuZGVidWcoJ0xvYWRlZCcpO1xuXG5jb25zdCBuYW1lZE9wdGlvbiA9IC9eLS0vO1xuY29uc3QgaGVhZGVyID0gL14oXFx3KyhcXHMrKT8pK1xcOiQvaTtcblxuZnVuY3Rpb24gcGFyc2VObyhvcHRpb24sIHN0cikge1xuICBpZiAoIXN0cikgcmV0dXJuO1xuXG4gIGxldCBjbWQgPSBzdHIucmVwbGFjZSgnLS0nLCAnJyk7XG5cbiAgaWYgKC9uby0vLnRlc3QoY21kKSkge1xuICAgIGxvZ2dlci5kZWJ1ZygnUGFyc2luZyBubyBvcHRpb24nLCBzdHIpO1xuICAgIGNtZCA9IGNtZC5yZXBsYWNlKCduby0nLCAnJyk7XG4gICAgb3B0aW9uLmRlZmF1bHQgPSAndHJ1ZSc7XG4gIH1cblxuICBvcHRpb24ub3B0aW9uID0gY21kO1xuXG4gIHJldHVybiBvcHRpb247XG59XG5cbmZ1bmN0aW9uIHBhcnNlRG91YmxlKGFycikge1xuICBjb25zdCBkZXNjcmlwdGlvbiA9IGFyclxuICAgIC5zbGljZSgyKVxuICAgIC5maWx0ZXIoQm9vbGVhbilcbiAgICAuam9pbignICcpO1xuXG4gIGNvbnN0IFtvcHRpb24sIGFsaWFzXSA9IGFycjtcblxuICByZXR1cm4ge1xuICAgIG9wdGlvbjogb3B0aW9uLnJlcGxhY2UoJy0tJywgJycpLFxuICAgIHR5cGU6ICdCb29sZWFuJyxcbiAgICBhbGlhczogYWxpYXMucmVwbGFjZSgnLS0nLCAnJyksXG4gICAgZGVzY3JpcHRpb246IGRlc2NyaXB0aW9uLFxuICB9O1xufVxuXG5mdW5jdGlvbiBwYXJzZVJlZ3VsYXIoYXJyKSB7XG4gIGNvbnN0IFtpdGVtXSA9IGFycjtcbiAgbG9nZ2VyLmRlYnVnKCdQYXJzaW5nICVzJywgaXRlbSk7XG5cbiAgaWYgKCFpdGVtKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgY29uc3QgW29wdGlvblRleHRdID0gYXJyO1xuICBjb25zdCB0eXBlID0gYXJyWzFdIHx8ICdCb29sZWFuJztcbiAgY29uc3Qgb3B0aW9uID0gcGFyc2VObyh7fSwgb3B0aW9uVGV4dCk7XG4gIGNvbnN0IGhlbHBUZXh0ID0gYXJyLmZpbHRlcigoYSkgPT4gYSAhPT0gb3B0aW9uVGV4dCAmJiBhICE9PSB0eXBlICYmIGEgIT09ICcnKTtcbiAgY29uc3QgZGVzY3JpcHRpb24gPSBoZWxwVGV4dC5qb2luKCcgJyk7XG5cbiAgb3B0aW9uLnR5cGUgPSB0eXBlO1xuXG4gIGlmIChkZXNjcmlwdGlvbikge1xuICAgIG9wdGlvbi5kZXNjcmlwdGlvbiA9IGRlc2NyaXB0aW9uO1xuICB9XG5cbiAgcmV0dXJuIG9wdGlvbjtcbn1cblxuZnVuY3Rpb24gcGFyc2VBbGlhcyhhcnIgPSBbXSkge1xuICBjb25zdCBbYWxpYXNdID0gYXJyO1xuXG4gIGxvZ2dlci5kZWJ1ZygnQWxpYXMgZm91bmQ6ICVzJywgYWxpYXMpO1xuICBjb25zdCBvcHRpb24gPSBwYXJzZVJlZ3VsYXIoYXJyLmZpbHRlcigoYSkgPT4gYSAhPT0gYWxpYXMpKTtcblxuICBpZiAoYWxpYXMpIHtcbiAgICBvcHRpb24uYWxpYXMgPSBhbGlhcy5yZXBsYWNlKCctJywgJycpO1xuICB9XG5cbiAgcmV0dXJuIG9wdGlvbjtcbn1cblxuZnVuY3Rpb24gY3JlYXRlT3B0aW9uKGFycikge1xuICBsZXQgb3B0aW9uO1xuXG4gIGlmIChuYW1lZE9wdGlvbi50ZXN0KGFyclswXSkgJiYgbmFtZWRPcHRpb24udGVzdChhcnJbMV0pKSB7XG4gICAgLy8gbmVnYXRlZCBib29sZWFuXG4gICAgb3B0aW9uID0gcGFyc2VEb3VibGUoYXJyKTtcbiAgfSBlbHNlIGlmIChuYW1lZE9wdGlvbi50ZXN0KGFyclswXSkgJiYgIW5hbWVkT3B0aW9uLnRlc3QoYXJyWzFdKSkge1xuICAgIC8vIG5vIGFsaWFzXG4gICAgb3B0aW9uID0gcGFyc2VSZWd1bGFyKGFycik7XG4gIH0gZWxzZSB7XG4gICAgLy8gYWxpYXNlZCBvciBvdGhlclxuICAgIG9wdGlvbiA9IHBhcnNlQWxpYXMoYXJyKTtcbiAgfVxuXG4gIHJldHVybiBpc0VtcHR5KG9wdGlvbikgPyB1bmRlZmluZWQgOiBvcHRpb247XG59XG5cbmZ1bmN0aW9uIHBhcnNlSGVscChoZWxwVGV4dCkge1xuICByZXR1cm4gaGVscFRleHQuc3BsaXQoJ1xcbicpLnJlZHVjZSgoYWNjLCBsaW5lLCBpbmRleCkgPT4ge1xuICAgIGlmICghbGluZSB8fCBpbmRleCA9PT0gMCkge1xuICAgICAgcmV0dXJuIGFjYztcbiAgICB9XG4gICAgaWYgKGluZGV4ID09PSAwKSB7XG4gICAgICByZXR1cm4gYWNjO1xuICAgIH1cblxuICAgIGlmIChoZWFkZXIudGVzdChsaW5lKSkge1xuICAgICAgYWNjLnB1c2goeyBoZWFkaW5nOiBsaW5lLnJlcGxhY2UoJzonLCAnJykgfSk7XG5cbiAgICAgIHJldHVybiBhY2M7XG4gICAgfVxuXG4gICAgY29uc3QgbGluZUFyciA9IGxpbmVcbiAgICAgIC5yZXBsYWNlKCcsJywgJycpXG4gICAgICAudHJpbSgpXG4gICAgICAuc3BsaXQoJyAnKTtcblxuICAgIGNvbnN0IG9wdGlvbiA9IGNyZWF0ZU9wdGlvbihsaW5lQXJyKTtcblxuICAgIGlmIChvcHRpb24ub3B0aW9uID09PSAnaGVscCcpIHtcbiAgICAgIHJldHVybiBhY2M7XG4gICAgfVxuXG4gICAgYWNjLnB1c2gob3B0aW9uKTtcblxuICAgIHJldHVybiBhY2M7XG4gIH0sIFtdKTtcbn1cblxuZXhwb3J0IGRlZmF1bHQge1xuICBwYXJzZUhlbHA6IHBhcnNlSGVscCxcbn07XG4iXX0=